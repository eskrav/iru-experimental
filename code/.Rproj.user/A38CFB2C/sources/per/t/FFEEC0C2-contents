# rm(list=ls())

library(tidyverse)
library(lme4)

dataI <- read_csv("/Users/ekravtch/Shared/informationally-redundant-utterances/data/incoherent/new/processed_data.csv", col_types = cols(
  workerid = col_factor(levels = NULL),
  list = col_factor(levels = NULL),
  item = col_factor(levels = NULL),
  condition = col_factor(levels = NULL),
  answer = col_factor(levels = NULL)
))

glimpse(dataI)

summary(dataI)

dataI %>%
  filter(condition != "contradictory") %>%
  group_by(item,condition) %>%
  summarise(yes = round(sum(answer=="\"Yes, the scenario is possible\"")/sum(!is.na(answer)),2)) %>%
#  arrange(yes) %>%
  print(n=Inf)

### 14, 15, 21 - predictable so predictable that incoherent

model <- glmer(answer ~ condition + (condition|workerid) + (condition|item), data=dataI, family=binomial)
summary(model)
coef(model)

dataI %>%
  group_by(workerid,condition) %>%
  summarise(yes = round(sum(answer=="\"Yes, the scenario is possible\"")/sum(!is.na(answer)),2)) %>%
  print(n=Inf)

dataI %>%
  group_by(item,condition) %>%
  summarise(yes = round(sum(answer=="\"Yes, the scenario is possible\"")/sum(!is.na(answer)),2)) %>%
  print(n=Inf)

filtered <- dataI %>%
  group_by(item,condition) %>%
  summarise(yes = round(sum(answer=="\"Yes, the scenario is possible\"")/sum(!is.na(answer)),2)) %>%
  print(n=Inf)

filtered %>%
  filter(condition != "contradictory") %>%
  filter(yes < 0.90) %>%
  print(n=Inf)

### 23 also possibly problem - borderline

# model <- glmer(answer ~ condition + (condition|item) + (condition|workerid), data=as.dataI.frame(filter(filtered, condition != "contradictory")), family=binomial)
# summary(model)
# coef(model)
