rm(list=ls())

library(tidyr)
library(readr)
library(dplyr)
library(stringr)
library(lme4)
library(ggplot2)
library(scales)
library(skimr)

data <- read_csv("/Users/ekravtch/Shared/referring-expressions/data/fully_annotated.csv")

summary(data)

data %>% glimpse()

data$cont_bias <- data$bias %>%
  recode_factor(ic1="Subj.-Biased", ic2="Obj.-Biased", source_goal="Obj.-Biased", goal_source="Subj.-Biased")

data$Continuation <- data$contGram %>%
  recode_factor(S = "Subject", O = "Object")

data$workerid <- parse_factor(data$workerid, levels=NULL)
data$list <- parse_factor(data$list, levels=NULL)
data$bias <- parse_factor(data$bias, levels=NULL)
data$cont_bias <- parse_factor(data$cont_bias, levels=NULL)
data$type <- parse_factor(data$type, levels=NULL)
data$itemNum <- parse_factor(data$itemNum, levels=NULL)
data$length <- parse_factor(data$length, levels=NULL)
data$sGender <- parse_factor(data$sGender, levels=NULL)
data$Continuation <- parse_factor(data$Continuation, levels=NULL)
data$contGender <- parse_factor(data$contGender, c("F","M"), include_na=FALSE)
data$contGram <- parse_factor(data$contGram, c("S","O"), include_na=FALSE, ordered=TRUE)
data$answerForm <- parse_factor(data$answerForm, c("long","pro"), include_na=FALSE, ordered=TRUE)

########### IC DATA

### Continuation

filter(data, type=="IC" & !is.na(answerForm)) %>%
  ggplot(aes(x = cont_bias, fill = Continuation)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ length) +
  scale_y_continuous(labels = percent_format()) + 
  labs(x="Continuation Bias", y="Percent Subj. Continuations") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("IC Continuations")

### Names

filter(data, type=="IC" & length=="Short" & !is.na(answerForm)) %>%
  ggplot(aes(x = Continuation, fill = answerForm)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ cont_bias) +
  scale_y_continuous(labels = percent_format()) +
  labs(x="Continuation",fill="RE Form", y="Percent Pronouns") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("Names")

### Descriptions

filter(data, type=="IC" & length=="Long" & !is.na(answerForm)) %>%
  ggplot(aes(x = Continuation, fill = answerForm)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ cont_bias) +
  scale_y_continuous(labels = percent_format()) +
  labs(x="Continuation",fill="RE Form", y="Percent Pronouns") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("Def. Descriptions")

########### ToP DATA

### Continuation

filter(data, type=="ToP" & !is.na(answerForm)) %>%
  ggplot(aes(x = cont_bias, fill = Continuation)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ length) +
  scale_y_continuous(labels = percent_format()) + 
  labs(x="Continuation Bias", y="Percent Subj. Continuations") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("ToP Continuations")

### Names

filter(data, type=="ToP" & length=="Short" & !is.na(answerForm)) %>%
  ggplot(aes(x = Continuation, fill = answerForm)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ cont_bias) +
  scale_y_continuous(labels = percent_format()) +
  labs(x="Continuation",fill="RE Form", y="Percent Pronouns") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("Names")

### Descriptions

filter(data, type=="ToP" & length=="Long" & !is.na(answerForm)) %>%
  ggplot(aes(x = Continuation, fill = answerForm)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ cont_bias) +
  scale_y_continuous(labels = percent_format()) +
  labs(x="Continuation",fill="RE Form", y="Percent Pronouns") +
  scale_fill_brewer(palette = "Greens") + 
  ggtitle("Def. Descriptions")

########### SUMMARY STATISTICS

# filter(data, type=="ToP") %>%
#   group_by(bias) %>%
#   summarise()